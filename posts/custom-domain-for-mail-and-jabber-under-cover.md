Свой домен для почты и джаббера под прикрытием
22-01-2012 21:38
google-apps, jabber, j2j

Каждый день просматривая различные документы, реквизиты фирм замечаю откровенный позор в виде почты на доменах Mail или Yandex. Можно еще простить это мелким
 частным предпринимателям (и то с натяжкой), но крупная компания (100+ человек) или еще интереснее государственная организация в моем понимании могут
 потратить совсем немного денег на оплату труда человека способного настроить почту на своем (зачастую уже существующем) домене.<!--more-->

Для себя я эту проблему давно решил выкупив домен garmash.org и прикрутив к нему Gmail. Как это сделать описывать не буду -
ищется в два клика. Стоит отметить, что почта на своем домене дает еще одно неочевидное преимущество: дополнительный уровень защиты и гибкость в работе с
входящей корреспонденцией. Gочта на своем домене появляется явно как вторая к основному ящику (к примеру на том же Gmail). Адрес этой почты уже у сотен
контактов, а тут новый ящик. Спамить оповещениями о смене адреса? На мой взгляд далеко не лучший вариант. Проще для всех и удобнее будет настроить обычную
пересылку на свой старый ящик и дополнительный адрес отправителя. Письма на новый ящик будут приходить в старый,
при ответе будет подставлен новый адрес. Еще один плюс - в вашем аккаунте, который видят все, не хранится никаких данных,
он по-сути является "ширмой" для вашего реального адреса.

С почтой разобрались, теперь о джаббере. Удобство Gmail и подобных сервисов в том, что ваш почтовый адрес является автоматически и Jabber-ID. Отдельно стоит
упомянуть web-клиент с хранением истории. Один минус с которым мы сегодня будем бороться - ваш джаббер-аккаунт будет всегда в оффлайне. Поможет нам в этом
технология  [XMPP-Transport](http://en.wikipedia.org/wiki/Extensible_Messaging_and_Presence_Protocol#Connecting_to_other_protocols).

Нам понадобится:

1. аккаунт на [gmail.com](http://gmail.com), назовем его мастер-аккаунт
2. аккаунт в Google Apps или любой другой XMPP-аккаунт, назовем его дополнительный аккаунт
3. рабочий XMPP-транспорт
4. jabber-клиент, например [Psi](http://psi-im.org)

Смысл следующих действий примерно таков. Архитектура протокола XMPP позволяет подключать к мастер-аккаунту другие сети посредством транспортов. Таким образом
 возможно подключение, например ICQ-аккаунта к вашему джаббер-аккаунту. Не трудно догадаться, что транспорт Jabber2Jabber позволяет подключить к одному
 джаббер аккаунту другой. При этом для всех кто будет с вами общаться все будет абсолютно прозрачно.

От теории к практике. На практике, увы не все так просто. Для подключения транспорта придется воспользоваться клиентом,
который поддерживает функцию Service Discovery. Я воспользовался кроссплатформенным клиентом [Psi](http://psi-im.org). Процедура подключения в общем-то
тривиальна.

1. регистрируем учетную запись мастер-аккаунта в Psi
2. в меню General выбираем пункт Service Discovery
3. выбираем нужный транспорт из [списка](http://www.jabberworld.info/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D1%82%D1%80%D0%B0%D0%BD%D1%81%D0%BF%D0%BE%D1%80%D1
%82%D0%BE%D0%B2_J2J) я использовал xmpp.jrudevels.org
4. регистрируемся в транспорте, важный момент для пользователей Google Apps: port - 5222, server - ваш домен, domain/ip - talk.google.com
5. авторизуем сообщение от транспорта
6. выходим из Psi и проверяем в Web-клиенте наличие транспорта в списке контактов

Теперь входящие контакты из транспорта будут иметь вид user%host.xx@xmpp.jrudevels.org. Отличаться от других контактов они не будут ничем, кроме имени.
Подроные инструкции в картинках есть [тут](http://wiki.jrudevels.org/J2J) и [тут](http://goondroid.com/gtalk-and-transports)

В сухом остатке имеем полность прозрачную переадресацию почты и джаббера в ваш любимый почтовый сервис.